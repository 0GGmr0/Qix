<html>
<head>
  <title>Node-MySQL模块中文文档</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
 
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1174"/>
模块Github地址：<a href="https://github.com/felixge/node-mysql">https://github.com/felixge/node-mysql</a><br/>
微博:<a href="http://weibo.com/ty4z2008">@廖君Jun</a>
<p style="color:red;">自己还是一个学生，第一次翻译。不恰当的地方还希望不吝批评。联系方式可以直接微博AT我</p>
<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div><span style="font-size: 14pt;"><b>安装</b></span></div><div style="margin-left: 30px;"><pre style="text-align: left;box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);">
npm install mysql
</pre></div><div style="text-align: left;">如果需要以前的版本0.9.x系列的文档，请访问<a href="https://github.com/felixge/node-mysql/tree/v0.9" shape="rect" target="_blank">v0.9 branch</a><span>.</span></div><div style="text-align: left;">有时你可以从github中安装最新版本的node-mysql，具体怎么做请参考下面的示例：</div><div style="text-align: left;"><pre style="margin-left: 30px;" xml:space="preserve"></pre><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51); text-align: start;"><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: none; background-color: transparent; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; padding: 0px; word-wrap: normal; display: inline; line-height: inherit;">npm install felixge/node-mysql</code></pre><span style="font-size: 14pt;"><b>介绍</b></span></div><div style="text-align: left;">这是一个node.Js的mysql驱动程序。这个驱动完全是用javascript写的，不需要任何编译工作。完全的遵守MIT开源协议。</div><div style="text-align: left;">这里有一个简单的示例告诉你如何使用它:</div><div style="text-align: left;"><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; text-align: start;"><span style="color: rgb(51, 51, 51); box-sizing: border-box; font-weight: bold;">var</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">mysql</span><font color="#333333">      </font><span style="color: rgb(51, 51, 51); box-sizing: border-box; font-weight: bold;">=</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">require</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'mysql'</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">);</span><span style="color: rgb(51, 51, 51); box-sizing: border-box; font-weight: bold;">var</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">connection</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box; font-weight: bold;">=</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">mysql</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">.</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">createConnection</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">({</span><font color="#333333">
  </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">host</span><font color="#333333">     </font><span style="color: rgb(51, 51, 51); box-sizing: border-box; font-weight: bold;">:</span><font color="#333333"> </font><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'localhost'</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">,</span><font color="#333333">
  </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">user</span><font color="#333333">     </font><span style="color: rgb(51, 51, 51); box-sizing: border-box; font-weight: bold;">:</span><font color="#333333"> </font><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'me'</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">,</span><font color="#333333">
  </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">password</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box; font-weight: bold;">:</span><font color="#333333"> </font><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'secret'</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">});</span><font color="#333333">

</font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">connection</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">.</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">connect</span><span style="box-sizing: border-box;"><font color="#333333">();</font><font color="#797979"><span style="font-size: medium; line-height: normal; text-align: left;"> /</span><span style="font-size: medium; line-height: normal; text-align: left;">/建立连接</span></font></span><br/><font color="#797979"></font><font color="#333333"></font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">connection</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">.</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">query</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'SELECT 1 + 1 AS solution'</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">,</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box; font-weight: bold;">function</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">(</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">err</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">,</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">rows</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">,</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">fields</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">)</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">{</span><font color="#333333">
  </font><span style="color: rgb(51, 51, 51); box-sizing: border-box; font-weight: bold;">if</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">(</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">err</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">)</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box; font-weight: bold;">throw</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">err</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">;</span><font color="#333333">

  </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">console</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">.</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">log</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'The solution is: '</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">,</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">rows</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">[</span><span style="box-sizing: border-box; color: rgb(0, 153, 153);">0</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">].</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">solution</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">);</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">});</span><font color="#333333">

</font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">connection</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">.</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">end</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">(); /</span><span style="box-sizing: border-box;"><font color="#797979">/释放连接</font></span></pre></div><div style="text-align: left;"><pre xml:space="preserve"><span><br clear="none"/>从上面这个例子中，你应该要知道如下的两点：</span></pre><ul><li><span>每个</span><span>方法</span><span>调用</span><span>在</span><span>连接</span><span>队列中是按</span><span>顺序执行</span><span>。</span></li><li>当使用end()函数关闭连接时候，你必须要确保你的所有查询都已经发送给了mysql服务器。否者end()之后的查询是无效的。</li></ul><p><span style="font-size: 14pt;"><b>贡献者</b></span></p></div><div style="margin-left: 30px;">非常感谢那些给这个模块开发作贡献的朋友，<span> </span><a href="https://github.com/felixge/node-mysql/graphs/contributors" shape="rect" target="_blank">GitHub Contributors page</a> </div><div style="margin-left: 30px;">其中，我特别需要感谢的两位：</div><div style="margin-left: 30px;"><a href="http://andrey.hristov.com/" shape="rect" target="_blank">Andrey Hristov</a><span> (Oracle) 与<a href="http://blog.ulf-wendel.de/" shape="rect" target="_blank">Ulf Wendel</a><span> (Oracle)</span>帮我解决了一些数据库协议上面的问题</span></div><div style="margin-left: 30px;"><span><br clear="none"/></span></div><div><span style="font-size: 14pt;"><b>赞助商</b></span></div><div style="margin-left: 30px;">特别的感谢下面这些公司在资金上面的赞助，让我能够有更多的时间在这个项目上面(下面的名次<span>根据</span>赞助<span>时间</span>排序)</div><div style="margin-left: 30px;"><ul><li><a href="http://transloadit.com/" shape="rect" target="_blank">Transloadit</a> (我的首位赞助公式，他们提供了文件上传与视频转码服务，瞧瞧吧)</li><li><a href="http://www.joyent.com/" shape="rect" target="_blank">Joyent</a></li><li><a href="http://pinkbike.com/" shape="rect" target="_blank">pinkbike.com</a></li><li><a href="http://www.holidayextras.co.uk/" shape="rect" target="_blank">Holiday Extras</a> (他们正在招聘<span> </span><a href="http://join.holidayextras.co.uk/vacancy/software-engineer/" shape="rect" target="_blank">hiring</a>)</li><li><a href="http://newscope.com/" shape="rect" target="_blank">Newscope</a> (<span>他们正在招聘</span><a href="http://www.newscope.com/stellenangebote" shape="rect" target="_blank">hiring</a>)</li></ul><p><br clear="none"/></p><div>如果你也对这个项目感兴趣，那么你也可以赞助我们，请点击<a href="http://felixge.de/#consulting" shape="rect" target="_blank">get in touch</a></div><div><b><span style="font-size: 14pt; text-align: left;"><br/></span></b></div><div><b><span style="font-size: 14pt; text-align: left;">社区</span><span style="font-size: 19px; text-align: left;">支持</span></b></div></div><div style="text-align: left;margin-left: 30px;">如果你也想参与到这个模版讨论，或者是有问题需要询问，可以通过下面的方式来联系：</div><ul><li>Google论坛：<a href="https://groups.google.com/forum/#!forum/node-mysql" shape="rect" target="_blank">https://groups.google.com/forum/#!forum/node-mysql</a></li><li>IRC频道：<span> #node.js (</span><span>freenode.net,只要包含有mysql的所有问题我都会关注的)</span></li></ul><div style="margin-left: 30px;"><span style="font-size: 14pt;"><b>创建连接</b></span></div><div style="margin-left: 30px;">推荐的一种连接方式：</div><div style="margin-left: 30px;"><div style="box-sizing: border-box; background-color: rgb(255, 255, 255); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px;"><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal;"><span style="color: rgb(51, 51, 51); box-sizing: border-box; font-weight: bold;">var</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">mysql</span><font color="#333333">      </font><span style="color: rgb(51, 51, 51); box-sizing: border-box; font-weight: bold;">=</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">require</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'mysql'</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">);</span><span style="color: rgb(51, 51, 51); box-sizing: border-box; font-weight: bold;">var</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">connection</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box; font-weight: bold;">=</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">mysql</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">.</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">createConnection</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">({</span><font color="#333333">
  </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">host</span><font color="#333333">     </font><span style="color: rgb(51, 51, 51); box-sizing: border-box; font-weight: bold;">:</span><font color="#333333"> </font><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'example.org'</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">,</span><font color="#333333">
  </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">user</span><font color="#333333">     </font><span style="color: rgb(51, 51, 51); box-sizing: border-box; font-weight: bold;">:</span><font color="#333333"> </font><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'bob'</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">,</span><font color="#333333">
  </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">password</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box; font-weight: bold;">:</span><font color="#333333"> </font><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'secret'</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">});</span><font color="#333333">

</font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">connection</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">.</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">connect</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">(</span><span style="color: rgb(51, 51, 51); box-sizing: border-box; font-weight: bold;">function</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">(</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">err</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">)</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">{</span><font color="#333333">
  </font><span style="box-sizing: border-box;"><font color="#999988"><i>// 成功连接! (unless `err` is set)
</i></font></span><font color="#333333">});</font></pre></div></div><div style="margin-left: 30px;"><pre xml:space="preserve"><span><br clear="none"/>然而，一个连接只能隐式的调用一个query函数。调用方式如下：<br clear="none"/></span></pre><pre xml:space="preserve"></pre><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);"><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">mysql</span>      <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">require</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'mysql'</span><span style="box-sizing: border-box;">);</span><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">connection</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">mysql</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">createConnection</span><span style="box-sizing: border-box;">(...);</span>

<span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'SELECT 1'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">rows</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
  <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// 成功连接! (unless `err` is set)
</span><span style="box-sizing: border-box;">});</span></pre><pre xml:space="preserve"><span>上面的两种错误处理方法都合适，这取决于你更喜欢那一种方式来做数据库错误信息处理。任何一种连接上的错误（握手与网络）都会被视为致命错误，具体更多的错误处理信息可以查看<a href="#error-handling" shape="rect" target="_blank">Error Handling</a>章节。<br clear="none"/><br clear="none"/><span style="font-size: 14pt;"><b>连接可选参数</b></span><br clear="none"/>当我们使用Node-MySQL建立一个数据库连接的时候你可以通过下面这些选项：</span></pre><ul><li><span><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">host</span>:数据库的主机名（默认： <span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">localhost</span>）</span><br clear="none"/></li><li><span><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">port</span>:<span>数据库服务器的</span>端口（默认： <span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">3306</span>）</span></li><li><span><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">localAddress</span>:使用TCP连接的源IP地址（可选）</span></li><li><span><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">socketPath</span>:使用Unix域套接字连接的路径，当使用 <code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; padding: 0px; color: rgb(51, 51, 51); text-align: left;">host</code><span style="color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px; text-align: left; background-color: rgb(255, 255, 255);"> </span>与 <code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; padding: 0px; color: rgb(51, 51, 51); text-align: left;">port</code><span style="color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px; text-align: left; background-color: rgb(255, 255, 255);"> </span>的时候可以忽略。</span></li><li><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">user</span>:这个是MySQL身份验证的用户名。</li><li><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">password</span>:<span>MySQL用户的密码。</span></li><li><span><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">database</span>:连接的数据库名(可选).</span></li><li><span><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">charset</span>:连接之后的字符编码(默认:<span>' <span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">UTF8_GENERAL_CI</span>',值得提醒的是，这个值必须都是大写字母</span>).</span></li><li><span><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">timezone</span>:这个是储存数据的是当前时间。(默认:‘ <span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">local</span>’).</span></li><li><span><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">connectTimeout</span>:MySQL初始连接的超时时间。单位是毫秒(默认:无超时限制)。</span></li><li><span><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">stringifyObjects</span>:把值转换为Stringify对象。具体见问题<a href="https://github.com/felixge/node-mysql/issues/501" shape="rect" target="_blank">#501</a>。(默认：' <span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">false</span>')。</span></li><li><span><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">insecureAuth</span>:允许使用老（不安全）的身份认证方式去连接MySQL数据库.(默认： <span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">false</span>).</span></li><li><span><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">typeCast</span>:是否把结果值转换为原生的javascript类型(默认: <span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">true</span>).</span></li><li><span><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">queryFormat</span>:一个可以自己定义查询格式函数(具体见<a href="https://github.com/felixge/node-mysql#custom-format" shape="rect" target="_blank">Custom format</a>)。</span></li><li><span><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">supportBigNumbers</span>: 当在数据库中处理一个大数(BIGINT和DECIMAL)数据类型的时候，你需要启用这个选项(默认: <span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">false</span>).</span></li><li><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">bigNumberStrings</span>:这个选项需要<span><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">bigNumberStrings</span>与 <span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">supportBigNumbers</span>同时启用，强制把数据库中<span>大数(BIGINT和DECIMAL)数据类型的值转换为</span>javascript字符对象串对象返回。(默认:false)。当启用<span style="background-color: rgb(248, 248, 248); color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20px; text-align: left;">supportBigNumbers</span>选项，但 <span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">bigNumberStrings</span>是未启用的状态。当无法用javascript数字对象(<a href="http://ecma262-5.com/ELS5_HTML.htm#Section_8.5" shape="rect" target="_blank">JavaScript Number objects</a>)所表达的时候就会返回的是一个big number字符串对象(值的范围要在 [-2^53, +2^53]之间).否则将会返回一个Number类型的对象。如果<span style="background-color: rgb(248, 248, 248); color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20px; text-align: left;">supportBigNumbers</span>是false那么这个选项会被自动忽略。</span></li><li><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">dateStrings</span>:强制为date类型(TIMESTAMP，DATETIME，DATE)转化为一个字符串返回而不是转换成javascript的date类型对象。(默认: <span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">false</span>)</li><li><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">debug</span>:答应协议详细信息到标准输出(默认: <span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">false</span>).</li><li><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">trace</span>:产生栈跟踪当在库的入口点出现error时,当调用数次很多时性能会略微下降(默认: <span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">true</span>).</li><li><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">multipleStatements</span>:允许每个mysql语句有多条查询.使用它时要非常注意，因为它很容易引起sql注入攻击<span>(默认:<span style="background-color: rgb(248, 248, 248); color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20px; text-align: left;">false</span>).</span></li><li><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">flags</span>:使用连接标示符号标示出超过默认的值的连接。它也可以加到默认的黑名单连接中。更多信息参考（<a href="https://github.com/felixge/node-mysql#connection-flags" shape="rect" target="_blank">Connection Flags</a>）。 </li><li><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">ssl</span>:使用ssl参数对象(格式参考<a href="http://nodejs.org/api/crypto.html#crypto_crypto_createcredentials_details" shape="rect" target="_blank">crypto.createCredentials</a>参数)或者是用一个包含ssl配置的字符串名。目前仅仅支持亚马逊的ca证书，参考：<a href="https://rds.amazonaws.com/doc/rds-ssl-ca-cert.pem" shape="rect" target="_blank">https://rds.amazonaws.com/doc/rds-ssl-ca-cert.pem<br clear="none"/></a></li></ul></div><div style="margin-left: 30px;">除了利用这些选项来做对象使用，你也可以用一个字符串来标示。例如：</div><div style="margin-left: 30px;"><div style="box-sizing: border-box; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px;"><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal;"><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">connection</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">mysql</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">createConnection</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'mysql://user:pass@host/db?debug=true&amp;charset=BIG5_CHINESE_CI&amp;timezone=-0700'</span><span style="box-sizing: border-box;">);</span></pre></div><pre xml:space="preserve"><span><strong>注意</strong>：查询出来的值第一会尝试转换为json格式,如果转换失败.那么就会转换成纯文本的字符串.<br clear="none"/><br clear="none"/><b><span style="font-size: 14pt;">关闭连接</span><br clear="none"/></b>有两种关闭连接的方式，当查询完成后最优雅关闭连接方式是调用</span><span style="background-color: rgb(248, 248, 248); color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px;">end()</span>方法,例如：
</pre><pre xml:space="preserve"></pre><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);"><span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">end</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
  <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// 连接在这里会被终止
</span><span style="box-sizing: border-box;">});</span></pre><pre>
这样可以确保在查询队列完成之后发送一个<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; padding: 0px; color: rgb(51, 51, 51);">COM_QUIT</code><span style="color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px; background-color: rgb(255, 255, 255);"> </span>包到mysql服务器。如果在发送<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; padding: 0px; color: rgb(51, 51, 51);">COM_QUIT</code><span style="color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px; background-color: rgb(255, 255, 255);"> </span>出现致命的错误。在回调函数里面有一个err参数可以使用。但是这个连接无论如何也会被关闭掉。
</pre><pre xml:space="preserve"><span><br clear="none"/>另外一种替代</span><span style="background-color: rgb(248, 248, 248); color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px;">end()</span>方法的是调用<span style="background-color: rgb(248, 248, 248); color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px;">destroy()</span>方法，这个方法会立即终止底层socket连接.<span style="background-color: rgb(248, 248, 248); color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px;">destroy()</span>方法确保了没有任何事件或回调再连接触发。
</pre><pre xml:space="preserve"></pre><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);"><span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">destroy</span><span style="box-sizing: border-box;">();</span></pre><pre>

<span style="color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px; white-space: normal; background-color: rgb(255, 255, 255);"> </span><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; padding: 0px; color: rgb(51, 51, 51); white-space: normal;">destroy()</code>方法不像<span style="background-color: rgb(248, 248, 248); color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px;">end()</span>方法，<span style="color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px; background-color: rgb(255, 255, 255);"> </span><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; padding: 0px; color: rgb(51, 51, 51);">destroy()</code>方法是没有任何回调参数的。
</pre><pre xml:space="preserve"><br clear="none"/><span style="font-size: 14pt;"><b>连接池</b></span><br clear="none"/>直接使用连接池<br clear="none"/></pre><pre xml:space="preserve"></pre><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);"><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">mysql</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">require</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'mysql'</span><span style="box-sizing: border-box;">);</span><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">pool</span>  <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">mysql</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">createPool</span><span style="box-sizing: border-box;">({</span>
  <span style="box-sizing: border-box;">host</span>     <span style="box-sizing: border-box; font-weight: bold;">:</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'example.org'</span><span style="box-sizing: border-box;">,</span>
  <span style="box-sizing: border-box;">user</span>     <span style="box-sizing: border-box; font-weight: bold;">:</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'bob'</span><span style="box-sizing: border-box;">,</span>
  <span style="box-sizing: border-box;">password</span> <span style="box-sizing: border-box; font-weight: bold;">:</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'secret'</span><span style="box-sizing: border-box;">});</span>

<span style="box-sizing: border-box;">pool</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'SELECT 1 + 1 AS solution'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">rows</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">fields</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
  <span style="box-sizing: border-box; font-weight: bold;">if</span> <span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box; font-weight: bold;">throw</span> <span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">;</span>

  <span style="box-sizing: border-box;">console</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">log</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'The solution is: '</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">rows</span><span style="box-sizing: border-box;">[</span><span style="box-sizing: border-box; color: rgb(0, 153, 153);">0</span><span style="box-sizing: border-box;">].</span><span style="box-sizing: border-box;">solution</span><span style="box-sizing: border-box;">);
</span><span style="box-sizing: border-box;">});</span></pre><pre>
连接可以轻易的共享一个连接或者是管理多个连接：<br clear="none"/></pre><pre xml:space="preserve"></pre><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);"><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">mysql</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">require</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'mysql'</span><span style="box-sizing: border-box;">);</span><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">pool</span>  <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">mysql</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">createPool</span><span style="box-sizing: border-box;">({</span>
  <span style="box-sizing: border-box;">host</span>     <span style="box-sizing: border-box; font-weight: bold;">:</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'example.org'</span><span style="box-sizing: border-box;">,</span>
  <span style="box-sizing: border-box;">user</span>     <span style="box-sizing: border-box; font-weight: bold;">:</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'bob'</span><span style="box-sizing: border-box;">,</span>
  <span style="box-sizing: border-box;">password</span> <span style="box-sizing: border-box; font-weight: bold;">:</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'secret'</span><span style="box-sizing: border-box;">});</span>

<span style="box-sizing: border-box;">pool</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">getConnection</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
  <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// 连接成功! (除非有`err` )
</span><span style="box-sizing: border-box;">});</span></pre><pre xml:space="preserve"><br clear="none"/>如果你想在连接前设置session变量并且获取使用。你可以监听connection事件：
</pre><pre xml:space="preserve"></pre><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);"><span style="box-sizing: border-box;">pool</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">on</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'connection'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
  <span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'SET SESSION auto_increment_increment=1'</span><span style="box-sizing: border-box;">)
</span><span style="box-sizing: border-box;">});</span></pre><pre>
当你的连接完成后，只需要调用connection.release()方法。将连接返回到池中，以供其他人再次使用。<br clear="none"/></pre><pre xml:space="preserve"></pre><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal;"><span style="color: rgb(51, 51, 51); box-sizing: border-box; font-weight: bold;">var</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">mysql</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box; font-weight: bold;">=</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">require</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'mysql'</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">);</span><span style="color: rgb(51, 51, 51); box-sizing: border-box; font-weight: bold;">var</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">pool</span><font color="#333333">  </font><span style="color: rgb(51, 51, 51); box-sizing: border-box; font-weight: bold;">=</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">mysql</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">.</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">createPool</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">(...);</span><font color="#333333">

</font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">pool</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">.</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">getConnection</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">(</span><span style="color: rgb(51, 51, 51); box-sizing: border-box; font-weight: bold;">function</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">(</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">err</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">,</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">connection</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">)</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">{</span><font color="#333333">
  </font><span style="box-sizing: border-box; font-style: italic;"><font color="#999988">// </font><span style="font-size: medium; line-height: normal;"><font color="#797979">使用连接</font></span></span><font color="#333333">
  </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">connection</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">.</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">query</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">(</span><font color="#333333"> </font><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'SELECT something FROM sometable'</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">,</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box; font-weight: bold;">function</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">(</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">err</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">,</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">rows</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">)</span><font color="#333333"> </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">{</span><font color="#333333">
    </font><span style="box-sizing: border-box; font-style: italic;"><font color="#999988">// </font><span style="font-size: medium; line-height: normal;"><font color="#797979">连接使用完成后释放连接</font></span></span><font color="#333333">
    </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">connection</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">.</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">release</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">();</span><font color="#333333">
    </font><span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">//</span><span style="box-sizing: border-box; font-style: italic;"><font color="#797979"> <span style="font-size: medium; line-height: normal;">不要在这里使用connection进行查询，因为连接已经被归还到连接池了</span></font></span><font color="#333333">
  </font><span style="color: rgb(51, 51, 51); box-sizing: border-box;">});
</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">});</span></pre><pre xml:space="preserve"><span><br clear="none"/>如果你想关闭连接并且从连接池中移除，使用connection.destory()方法代替。当你下一次需要使用的时候，池会自动创建一个新的连接。<br clear="none"/>通过池创建连接是非常缓慢的。如果你配置你的连接池最大的连接数为100，当你只需要同时使用5个连接时候，它也仅仅只会创建5个连接。这种连接的循环方式是一种轮询(round-robin)的方式。采取的是从连接池顶部到底部的方式。<br clear="none"/><br clear="none"/><span style="font-size: 14pt;"><b>Pool参数选项</b></span><br clear="none"/>池连可以接受一些连接的参数选项。当一个连接创建之后，这些参数选项通过简单的构造传递到连接里面。池连接参数可以接受下面这些参数。</span><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; white-space: normal; background-color: rgb(248, 248, 248);">waitForConnections</span><span>:判断当前的连接是否可用并且是否已经达到了连接数的上限。如果是true。这个连接就会加入到连接队列中同时把状态转换为可用状态。如果是false，那么会立即返回一个错误给开发者。(默认：true).</span><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; white-space: normal; background-color: rgb(248, 248, 248);">connectionLimit</span><span>:一次连接最大的连接数(默认:10)。</span><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; white-space: normal; background-color: rgb(248, 248, 248);">queueLimit</span><span>:从getConnection获取连接数并且判断是否超出了queneLimit限制的排队等待的连接值，如果是就返回一个错误。如果设置为0，就是不限制连队列数(默认：0)。<br clear="none"/><br clear="none"/><span><span style="font-size: 14pt;">PoolCluster</span><br clear="none"/><span>PoolCluster提供了多台主机连接功能(group&amp;retry&amp;selector)：<br clear="none"/></span></span></span></pre><pre xml:space="preserve"></pre><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);"><span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// 创建连接
</span><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">poolCluster</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">mysql</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">createPoolCluster</span><span style="box-sizing: border-box;">();</span>

<span style="box-sizing: border-box;">poolCluster</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">add</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">config</span><span style="box-sizing: border-box;">);</span> <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// anonymous group
</span><span style="box-sizing: border-box;">poolCluster</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">add</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'MASTER'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">masterConfig</span><span style="box-sizing: border-box;">);
</span><span style="box-sizing: border-box;">poolCluster</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">add</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'SLAVE1'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">slave1Config</span><span style="box-sizing: border-box;">);
</span><span style="box-sizing: border-box;">poolCluster</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">add</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'SLAVE2'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">slave2Config</span><span style="box-sizing: border-box;">);</span>

<span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// 目标主机组 : ALL(anonymous, MASTER, SLAVE1-2), 连接方式 : round-robin(default)
</span><span style="box-sizing: border-box;">poolCluster</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">getConnection</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; font-weight: bold;">function</span> <span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{});</span>

<span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// 目标主机组 : MASTER, 连接方式: round-robin
</span><span style="box-sizing: border-box;">poolCluster</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">getConnection</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'MASTER'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; font-weight: bold;">function</span> <span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{});</span>

<span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// 目标主机组 : SLAVE1-2, 连接方式 : order
</span><span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// 如果不能连接到SLAVE1就连接SLAVE2（把SLAVE1从集群节点中删除）
</span><span style="box-sizing: border-box;">poolCluster</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">on</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'remove'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; font-weight: bold;">function</span> <span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">nodeId</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
  <span style="box-sizing: border-box;">console</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">log</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'REMOVED NODE : '</span> <span style="box-sizing: border-box; font-weight: bold;">+</span> <span style="box-sizing: border-box;">nodeId</span><span style="box-sizing: border-box;">);</span> <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// 节点ID= SLAVE1 
</span><span style="box-sizing: border-box;">});</span>

<span style="box-sizing: border-box;">poolCluster</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">getConnection</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'SLAVE*'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'ORDER'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; font-weight: bold;">function</span> <span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{

});</span>

<span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// 命名方式: of(pattern, selector)
</span><span style="box-sizing: border-box;">poolCluster</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">of</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'*'</span><span style="box-sizing: border-box;">).</span><span style="box-sizing: border-box;">getConnection</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; font-weight: bold;">function</span> <span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{

});</span>

<span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">pool</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">poolCluster</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">of</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'SLAVE*'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'RANDOM'</span><span style="box-sizing: border-box;">);
</span><span style="box-sizing: border-box;">pool</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">getConnection</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; font-weight: bold;">function</span> <span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{

});
</span><span style="box-sizing: border-box;">pool</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">getConnection</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; font-weight: bold;">function</span> <span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{

});</span>

<span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// 释放连接
</span><span style="box-sizing: border-box;">poolCluster</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">end</span><span style="box-sizing: border-box;">();</span></pre><pre xml:space="preserve"><span><br clear="none"/></span><span style="font-size: 14pt;"><b>PoolCluster选项</b><br clear="none"/></span></pre><ul><li><span>canRetry:如果是true,当连接失败时Poolcluster会尝试重新连接(默认:true)。</span></li><li><span>removeNodeErrorCount:如果连接失败,节点的errorCount将会增加.当errorCount大于removeNodeErrorCount时，会从poolCluster中移除一个节点。(默认:5).</span></li><li><span>defaultSelector:默认选择器(默认:RR).<br clear="none"/>
RR:选择一个交替(<span>轮循</span>)<br clear="none"/>
RANDOM：由随机函数选择一个节点.<br clear="none"/>
ORDER:按照顺序无条件的选择第一个节点。</span><pre xml:space="preserve"></pre><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);"><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">clusterConfig</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">{</span>
  <span style="box-sizing: border-box;">removeNodeErrorCount</span><span style="box-sizing: border-box; font-weight: bold;">:</span> <span style="box-sizing: border-box; color: rgb(0, 153, 153);">1</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// 连接失败后立即从把该节点移除</span>
  <span style="box-sizing: border-box;">defaultSelector</span><span style="box-sizing: border-box; font-weight: bold;">:</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'ORDER'</span><span style="box-sizing: border-box;">};</span>

<span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">poolCluster</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">mysql</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">createPoolCluster</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">clusterConfig</span><span style="box-sizing: border-box;">);</span></pre></li></ul><pre xml:space="preserve"><span style="font-size: 14pt;"><b>切换用户/修改连接状态</b></span><br clear="none"/>MySQL提供了ChangeUser的命令，允许你更改当前用户并且切换用户时不需要关闭底层socket连接:
</pre><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);"><span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">changeUser</span><span style="box-sizing: border-box;">({</span><span style="box-sizing: border-box;">user</span> <span style="box-sizing: border-box; font-weight: bold;">:</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'john'</span><span style="box-sizing: border-box;">},</span> <span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
  <span style="box-sizing: border-box; font-weight: bold;">if</span> <span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box; font-weight: bold;">throw</span> <span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">;
</span><span style="box-sizing: border-box;">});</span></pre><pre>
这个功能提供了几个有用的参数选项： 
</pre><ul><li><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">user</span>:新用户的名字。（默认为切换新用户前第一个用户）</li><li><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">password</span>:新用户的密码<span>（默认为切换新用户前第一个用户</span>）</li><li><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">charset</span>:新的字符编码<span>（默认为切换新用户前第一个用户</span><span>）</span></li><li><span><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">database</span>:新的数据库名<span>（默认为切换新用户前第一个用户</span><span>）</span></span></li></ul><br clear="none"/><pre xml:space="preserve">
这个功能有时有一个副作用，它会把所有的连接状态都重置（变量，事务）.
</pre><pre xml:space="preserve"><strong>注意：</strong>此操作出现的错误会被该模块视为致命错误处理。<br clear="none"/><br clear="none"/><span style="font-size: 14pt;"><b>服务器连接断开</b></span><br clear="none"/>由于网络问题你有可能丢失与MySQL服务器的连接。也有可能被服务器踢出连接，还有可能是服务器重启或是崩溃等等，这些都是致命的错误都被归为error对象里面。并且模块提供了<span style="background-color: rgb(248, 248, 248); color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px;">err.code = 'PROTOCOL_CONNECTION_LOST'</span>信息，更多的错误处理信息请参考<a href="#error-handling" shape="rect" target="_blank">Error Handling</a> 。
</pre><pre xml:space="preserve"><span>与服务器重连是建立一个新的连接，一旦现在的连接断开就不能让这个连接重新连接。它必须重新建立一条连接，连接到数据库服务器。<br clear="none"/>在连接池里面，当连接断开时会从连接池里面把连接移除，当下次需要连接的时候调用getConnection创建一个新的连接。<br clear="none"/><b><br clear="none"/><span style="font-size: 14pt;">转义查询值</span></b><br clear="none"/>为了避免被SQL注入攻击,你需要把用户提交过来的数据进行转义之后再放到SQL查询语句里面。模块提供了</span><span style="background-color: rgb(248, 248, 248); color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px;">connection.escape()</span>和<span style="background-color: rgb(248, 248, 248); color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px;">Pool.escape()</span>两种方法：
</pre><pre xml:space="preserve"></pre><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);"><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">userId</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'some user provided value'</span><span style="box-sizing: border-box;">;
</span><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">sql</span>    <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'SELECT * FROM users WHERE id = '</span> <span style="box-sizing: border-box; font-weight: bold;">+</span> <span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">escape</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">userId</span><span style="box-sizing: border-box;">);
</span><span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">sql</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">results</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
  <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// ...
</span><span style="box-sizing: border-box;">});</span></pre><pre>
或者，你可以使用占位符'<span style="background-color: rgb(248, 248, 248); color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px;">?</span>'来代替，同样的也能对传入的值进行转义:
</pre><pre xml:space="preserve"></pre><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);"><span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'SELECT * FROM users WHERE id = ?'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">[</span><span style="box-sizing: border-box;">userId</span><span style="box-sizing: border-box;">],</span> <span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">results</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
  <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// ...
</span><span style="box-sizing: border-box;">});</span></pre><pre xml:space="preserve">
这看起来像是使用了MySQL的预处理语句，其实同样的在MySQL内部也是使用了类似<span style="background-color: rgb(248, 248, 248); color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px;">connection.escape()</span>的方法。
</pre><pre xml:space="preserve">
不同的是类型转义的值不同。请看下面的解释:
</pre><ul><li>Number类型保存不变.</li><li>Boolean值被转换为了true/false字符串.</li><li>Date类型被转换为了<span>'YYYY-mm-dd HH:ii:ss'字符串</span></li><li><span>Buffer转换为了16进制，例如:<span>X'0fa5'</span></span></li><li>String转换为了安全的字符串。</li><li>Array转换为了list。例如:['a','b']会返回'a','b'</li><li>多维数组会被转换为多维list。例如<span>[['a', 'b'], ['c', 'd']]返回<span>('a', 'b'), ('c', 'd')</span></span></li><li><span>Object转换为<span>key = 'val';多维Object对象会转换为字符串.</span></span></li><li><span>undefined/null会转换为null</span></li><li><span><code>NaN</code><span> / </span><code>Infinity</code><span> 保持不变,因为MySQL现在并不支持这些对象，如果你把NaN/Infinity做为值,MySQL会报错.直到它们被MySQL支持。<br clear="none"/><br clear="none"/></span></span></li></ul><div>如果你留意了，你会发现转义查询值可以巧妙的用下面这种方式:</div><div><pre xml:space="preserve"></pre><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);"><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">post</span>  <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">{</span><span style="box-sizing: border-box;">id</span><span style="box-sizing: border-box; font-weight: bold;">:</span> <span style="box-sizing: border-box; color: rgb(0, 153, 153);">1</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">title</span><span style="box-sizing: border-box; font-weight: bold;">:</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'Hello MySQL'</span><span style="box-sizing: border-box;">};
</span><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">query</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'INSERT INTO posts SET ?'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">post</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">result</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
  <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// 非常完美！
</span><span style="box-sizing: border-box;">});
</span><span style="box-sizing: border-box;">console</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">log</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">sql</span><span style="box-sizing: border-box;">);</span> <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// INSERT INTO posts SET `id` = 1, `title` = 'Hello MySQL'</span></pre><pre><span>如果你觉得有必要自己去转义查询值，那么你可以直接去调用转义函数：</span></pre><pre xml:space="preserve"></pre><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);"><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">query</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">&quot;SELECT * FROM posts WHERE title=&quot;</span> <span style="box-sizing: border-box; font-weight: bold;">+</span> <span style="box-sizing: border-box;">mysql</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">escape</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">&quot;Hello MySQL&quot;</span><span style="box-sizing: border-box;">);</span>

<span style="box-sizing: border-box;">console</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">log</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">);</span> <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// SELECT * FROM posts WHERE title='Hello MySQL'</span></pre><pre xml:space="preserve"><span style="font-size: 14pt;"><b>转义查询标示符</b></span><br clear="none"/>如果你不信任用户提交过来的标示符(<span>(database / table / column name)</span>)。那么你需要使用mysql.escapeId(identifier)来转义:
</pre><pre xml:space="preserve"></pre><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);"><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">sorter</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'date'</span><span style="box-sizing: border-box;">;</span><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">query</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'SELECT * FROM posts ORDER BY '</span> <span style="box-sizing: border-box; font-weight: bold;">+</span> <span style="box-sizing: border-box;">mysql</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">escapeId</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">sorter</span><span style="box-sizing: border-box;">);</span>

<span style="box-sizing: border-box;">console</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">log</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">);</span> <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// SELECT * FROM posts ORDER BY `date`</span></pre><pre>
它还支持添加合格的转义符。不过得把转义的分成两部分:
</pre><div><pre xml:space="preserve"></pre><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);"><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">sorter</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'date'</span><span style="box-sizing: border-box;">;</span><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">query</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'SELECT * FROM posts ORDER BY '</span> <span style="box-sizing: border-box; font-weight: bold;">+</span> <span style="box-sizing: border-box;">mysql</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">escapeId</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'posts.'</span> <span style="box-sizing: border-box; font-weight: bold;">+</span> <span style="box-sizing: border-box;">sorter</span><span style="box-sizing: border-box;">);</span>

<span style="box-sizing: border-box;">console</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">log</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">);</span> <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// SELECT * FROM posts ORDER BY `posts`.`date`</span></pre><pre><span>或者,你可以使用</span>占位符'??'，它会自动转义查询的值：
</pre><pre xml:space="preserve"></pre><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);"><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">userId</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box; color: rgb(0, 153, 153);">1</span><span style="box-sizing: border-box;">;</span><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">columns</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">[</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'username'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'email'</span><span style="box-sizing: border-box;">];
</span><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">query</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'SELECT ?? FROM ?? WHERE id = ?'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">[</span><span style="box-sizing: border-box;">columns</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'users'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">userId</span><span style="box-sizing: border-box;">],</span> <span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">results</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
  <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// ...
</span><span style="box-sizing: border-box;">});</span>

<span style="box-sizing: border-box;">console</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">log</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">sql</span><span style="box-sizing: border-box;">);</span> <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// SELECT `username`, `email` FROM `users` WHERE id = 1</span></pre><pre><span><strong>请注意：最后的一个字符转义目前还在实验阶段，而且语法随时可能发生改变。</strong><br clear="none"/>当你使用.escape(),.query(),.escapeId()时可以有效的防御SQL注入攻击.<br clear="none"/>预查询<br clear="none"/>你可以使用mysql.format()去执行预处理多嵌套查询语句，利用适当的转义处理对于标示符与值.下面有一个简单的例子:</span></pre><pre xml:space="preserve"></pre><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);"><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">sql</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">&quot;SELECT * FROM ?? WHERE ?? = ?&quot;</span><span style="box-sizing: border-box;">;
</span><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">inserts</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">[</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'users'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'id'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">userId</span><span style="box-sizing: border-box;">];
</span><span style="box-sizing: border-box;">sql</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">mysql</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">format</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">sql</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">inserts</span><span style="box-sizing: border-box;">);</span></pre><pre><span>这种方法可以确保发送到数据库进行数据查询之前就能够保证查询语句的安全,在发送到数据库查询之前执行预查询，这个功能非常的有用。由于mysql.format是由sql的String.format暴露出来的。所以你可以你还可以选择传递</span>stringifyObject 和timezone对象(不强制要求)。并且允许您自定义把对象转换字符串的方法。以及特定地区的时间和时区(location  specific/timezone aware Date).
</pre><pre style="font-size: 19px;" xml:space="preserve"><b>自定义格式</b></pre><pre xml:space="preserve">
如果您喜欢其他样式的转义格式。你可以在连接配置选项中自定义你的功能函数。如果你还想使用escape()或其他内置的函数。可以直接调用
</pre><pre xml:space="preserve">
这儿我们提供了一个示例：
</pre><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);" xml:space="preserve"><span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">config</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">queryFormat</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box; font-weight: bold;">function</span> <span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">values</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
  <span style="box-sizing: border-box; font-weight: bold;">if</span> <span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; font-weight: bold;">!</span><span style="box-sizing: border-box;">values</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box; font-weight: bold;">return</span> <span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">;</span>
  <span style="box-sizing: border-box; font-weight: bold;">return</span> <span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">replace</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(0, 153, 38);">/\:(\w+)/g</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; font-weight: bold;">function</span> <span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">txt</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">key</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
    <span style="box-sizing: border-box; font-weight: bold;">if</span> <span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">values</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">hasOwnProperty</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">key</span><span style="box-sizing: border-box;">))</span> <span style="box-sizing: border-box;">{</span>
      <span style="box-sizing: border-box; font-weight: bold;">return</span> <span style="box-sizing: border-box; font-weight: bold;">this</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">escape</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">values</span><span style="box-sizing: border-box;">[</span><span style="box-sizing: border-box;">key</span><span style="box-sizing: border-box;">]);</span>
    <span style="box-sizing: border-box;">}</span>
    <span style="box-sizing: border-box; font-weight: bold;">return</span> <span style="box-sizing: border-box;">txt</span><span style="box-sizing: border-box;">;</span>
  <span style="box-sizing: border-box;">}.</span><span style="box-sizing: border-box;">bind</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; font-weight: bold;">this</span><span style="box-sizing: border-box;">));</span><span style="box-sizing: border-box;">};</span>

<span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">&quot;UPDATE posts SET title = :title&quot;</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">{</span> <span style="box-sizing: border-box;">title</span><span style="box-sizing: border-box; font-weight: bold;">:</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">&quot;Hello MySQL&quot;</span> <span style="box-sizing: border-box;">});</span></pre><pre xml:space="preserve">
获取插入值之后的ID
</pre><pre xml:space="preserve">
如果你想获取插入一行值之后，获取自动递增主键的ID。你可以这样获取:
</pre><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);" xml:space="preserve"><span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'INSERT INTO posts SET ?'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">{</span><span style="box-sizing: border-box;">title</span><span style="box-sizing: border-box; font-weight: bold;">:</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'test'</span><span style="box-sizing: border-box;">},</span> <span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">result</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
  <span style="box-sizing: border-box; font-weight: bold;">if</span> <span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box; font-weight: bold;">throw</span> <span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">;</span>

  <span style="box-sizing: border-box;">console</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">log</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">result</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">insertId</span><span style="box-sizing: border-box;">);</span><span style="box-sizing: border-box;">});</span></pre><pre xml:space="preserve">
当处理大数字的时候(超过javascriptNumber类型的精度),你需要启用supportBigNumbers以便把ID作为字符串类型读取。否者会抛出错误.
</pre><pre xml:space="preserve">
而且当从数据库中查询的数字是一个big number类型的时候，你也需要把supportBigNumbers选项设置为true，否则查询出来的数据在传输过来的时候由于精度限制，自动删除超出部分。
</pre><pre style="font-size: 19px;" xml:space="preserve"><b>执行并行查询</b></pre><pre xml:space="preserve">
MySQL的协议是顺序执行的。所以这就意味这你需要建立多个连接去实现并行查询,你应该需要一个池(Pool)来管理连接。一个简单的方法就是每一个连接都创建的一个HTTP请求连接.
</pre><pre style="font-size: 19px;" xml:space="preserve"><b>数据流查询</b></pre><pre xml:space="preserve">
有时，你可能去执行一个大的查询，并且要处理查询返回的每一行结果。那么你可以尝试这样做：
</pre><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);" xml:space="preserve"><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">query</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'SELECT * FROM posts'</span><span style="box-sizing: border-box;">);</span><span style="box-sizing: border-box;">query</span>
  <span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">on</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'error'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
    <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// 处理错误，当出现错误时,会立即发出一个end事件</span>
  <span style="box-sizing: border-box;">})</span>
  <span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">on</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'fields'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">fields</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
    <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// the field packets for the rows to follow</span>
  <span style="box-sizing: border-box;">})</span>
  <span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">on</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'result'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">row</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
    <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// 处理工程中涉及到I/O可以在这里先暂停连接</span>
    <span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">pause</span><span style="box-sizing: border-box;">();</span>

    <span style="box-sizing: border-box;">processRow</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">row</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">()</span> <span style="box-sizing: border-box;">{</span>
      <span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">resume</span><span style="box-sizing: border-box;">();</span>
    <span style="box-sizing: border-box;">});</span>
  <span style="box-sizing: border-box;">})</span>
  <span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">on</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'end'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">()</span> <span style="box-sizing: border-box;">{</span>
    <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// 获取所有查询内容</span>
  <span style="box-sizing: border-box;">});</span></pre></div></div><pre xml:space="preserve">
在上面的例子中请注意几件事情:
</pre><pre xml:space="preserve">
 
</pre><ul><li>同常的时候你希望当接收到一定数量的查询结果的时候再执行pause()方法,这数量取决于你查询总的数量和数据的大小。</li><li>pause()/resume()操作底层socket和解析器时，可以确定在调用pause()方法之后再有result事件被执行</li><li>当有多条数据流读取时，不能再给query()方法添加一个回调函数.</li><li>在'result'事件中不仅可以返回查询的数据也可以确认query/INSERT执行是否成功.</li></ul><div>除此之外，你应该有兴趣知道当前的模块并不支持单独一行的流读取。它们都是被缓存起来当SQL执行完之后一并把结果返回过来。假如你有在大型的案例中应用到了MySQL的流技术。我很想能够与您分享。</div><div><br clear="none"/></div><div><b><span style="font-size: 19px;">管道结果（Piping results）和</span><a href="http://blog.nodejs.org/2012/12/20/streams2/" shape="rect" style="font-size: 19px;">Streams2</a><br clear="none"/></b></div><div>query对象提供了一个非常方便的方法<span style="background-color: rgb(248, 248, 248); color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px;">.stream(可选)</span>.它把查询事件封装成了<a href="http://nodejs.org/api/stream.html#stream_class_stream_readable" shape="rect">可读</a>(<a href="http://nodejs.org/api/stream.html#stream_class_stream_readable" shape="rect" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px; background-color: rgb(255, 255, 255);">Readable</a>)的Streams2对象,此流可以很容易地通过管道downstream，并提供自动化暂停/恢复，基于downstream堵塞和可选<span style="background-color: rgb(248, 248, 248); color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px;">highWaterMark</span>。该流的<span style="background-color: rgb(248, 248, 248); color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px;">objectMode</span>参数默认设为<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; padding: 0px; color: rgb(51, 51, 51);">true</code><span style="color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px; background-color: rgb(255, 255, 255);"> </span>。</div><div>例如，把查询结果通过piping导入到另一个流中(最大缓存为5)的简单例子：<br clear="none"/><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);" xml:space="preserve"><span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'SELECT * FROM posts'</span><span style="box-sizing: border-box;">)</span>
  <span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">stream</span><span style="box-sizing: border-box;">({</span><span style="box-sizing: border-box;">highWaterMark</span><span style="box-sizing: border-box; font-weight: bold;">:</span> <span style="box-sizing: border-box; color: rgb(0, 153, 153);">5</span><span style="box-sizing: border-box;">})</span>
  <span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">pipe</span><span style="box-sizing: border-box;">(...);</span></pre></div><div style="font-size: 19px;"><b>多语句查询</b></div><div>出于安全考虑，多语句查询默认是禁用的.(如果值没有经过转义，那么很有可能会导致SQL注入攻击)。如果你想使用此功能，你必须在连接中启用它：</div><div><div style="box-sizing: border-box; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px;"><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal;" xml:space="preserve"><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">connection</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">mysql</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">createConnection</span><span style="box-sizing: border-box;">({</span><span style="box-sizing: border-box;">multipleStatements</span><span style="box-sizing: border-box; font-weight: bold;">:</span> <span style="box-sizing: border-box; font-weight: bold;">true</span><span style="box-sizing: border-box;">});</span></pre></div>
一旦启用，你就可以执行多条语句查询了。例如：</div><div><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);" xml:space="preserve"><span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'SELECT 1; SELECT 2'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">results</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
  <span style="box-sizing: border-box; font-weight: bold;">if</span> <span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box; font-weight: bold;">throw</span> <span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">;</span>

  <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// `results` is an array with one element for every statement in the query:</span>
  <span style="box-sizing: border-box;">console</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">log</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">results</span><span style="box-sizing: border-box;">[</span><span style="box-sizing: border-box; color: rgb(0, 153, 153);">0</span><span style="box-sizing: border-box;">]);</span> <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// [{1: 1}]</span>
  <span style="box-sizing: border-box;">console</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">log</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">results</span><span style="box-sizing: border-box;">[</span><span style="box-sizing: border-box; color: rgb(0, 153, 153);">1</span><span style="box-sizing: border-box;">]);</span> <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// [{2: 2}]</span><span style="box-sizing: border-box;">});</span></pre></div><pre xml:space="preserve">
此外，您也可以串行理的多个语句查询的结果：
</pre><pre xml:space="preserve">
 
</pre><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);" xml:space="preserve"><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">query</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'SELECT 1; SELECT 2'</span><span style="box-sizing: border-box;">);</span>

<span style="box-sizing: border-box;">query</span>
  <span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">on</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'fields'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">fields</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">index</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
    <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// the fields for the result rows that follow</span>
  <span style="box-sizing: border-box;">})</span>
  <span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">on</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'result'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">row</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">index</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
    <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// index refers to the statement this result belongs to (starts at 0)</span>
  <span style="box-sizing: border-box;">});</span></pre><pre xml:space="preserve"><span>如果你有一个查询语句出现了错误，那么抛出的错误会包含在</span><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; white-space: normal; background-color: rgb(248, 248, 248);">err.index属性里面并且会告诉你是哪条语句出现了错误。同时当发生错误时对于剩余的查询语句MySQL也会停止执行.</span></pre><pre xml:space="preserve"><span style="color: #333333; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: small;"><span style="line-height: 20px; white-space: normal;">注意：目前利用流来执行多条查询语句的接口还在试验阶段。所以我很期待能够得到您的反馈。</span></span></pre><span style="color: #333333; font-family: Consolas, 'Liberation Mono', Courier, monospace;"><span style="line-height: 20px; white-space: normal;"><span style="font-size: 19px;"><b>储存过程</b><br clear="none"/></span></span></span><pre xml:space="preserve"><span style="line-height: 20px; white-space: normal; color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: small;">你可以在你的查询语句里面调用MySQL驱动中自带的任何存储过程，如果你使用存储过程生成的多个结果集，其实也就与您使用多语句查询生成得出的结果是一样的。</span></pre><span style="color: #333333; font-family: Consolas, 'Liberation Mono', Courier, monospace;"><span style="line-height: 20px; white-space: normal;"><span style="font-size: 19px;"><b>合并重叠的字段</b><br clear="none"/></span></span></span><pre xml:space="preserve"><span style="line-height: 20px; white-space: normal; color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: small;">当我们使用JOIN函数执行查询的时候得到的结果里面有很多字段是重复的。默认情况下Node-MySQL会按照列读取顺序把一些冲突的列名进行合并。但是这样有可能会导致一些接收到的值变得不可用。</span></pre><pre xml:space="preserve">
不过，您可以指定在表名中嵌套您需要的列，就像这样： 
</pre><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);" xml:space="preserve"><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">options</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">{</span><span style="box-sizing: border-box;">sql</span><span style="box-sizing: border-box; font-weight: bold;">:</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'...'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">nestTables</span><span style="box-sizing: border-box; font-weight: bold;">:</span> <span style="box-sizing: border-box; font-weight: bold;">true</span><span style="box-sizing: border-box;">};</span><span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">options</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">results</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
  <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">/* 结果将会像下面这样的数组形式返回:</span><span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;"> 
[{
</span><span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">  table1: {</span><span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">    
            fieldA: '...',</span><span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">    
            fieldB: '...',</span><span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">    
     },</span><span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">  
  table2: {</span><span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">   
           fieldA: '...',</span><span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">  
          fieldB: '...',</span><span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">   
    },</span><span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;"> 
 }, ...]</span><span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">  
*/
</span><span style="box-sizing: border-box;">});</span></pre><pre xml:space="preserve"><span style="color: #333333; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: small;"><span style="line-height: 20px; white-space: normal;">或者你可以使用字符串分隔符</span></span><span style="line-height: 20px; white-space: normal; color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: small;">合并成你想要的</span><span style="line-height: 20px; white-space: normal; color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: small;">结果:</span></pre><pre xml:space="preserve"></pre><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);"><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">options</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">{</span><span style="box-sizing: border-box;">sql</span><span style="box-sizing: border-box; font-weight: bold;">:</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'...'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">nestTables</span><span style="box-sizing: border-box; font-weight: bold;">:</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'_'</span><span style="box-sizing: border-box;">};
</span><span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">options</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">results</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
  <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">/* 
results will be an array like this now:</span><span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;"> 
 [{</span><span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">    table1_fieldA: '...',</span><span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">    
table1_fieldB: '...',</span><span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">   
 table2_fieldA: '...',</span><span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">   
 table2_fieldB: '...',
</span><span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">  },
 ...
]</span><span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">  
*/
</span><span style="box-sizing: border-box;">});</span></pre><pre xml:space="preserve"><span style="line-height: 20px; white-space: normal; color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace;"><span style="font-size: 19px;"><b>事务处理</b></span><br clear="none"/><span style="font-size: small;">在连接层中可以支持简单的事务处理：</span><br clear="none"/></span></pre><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);" xml:space="preserve"><span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">beginTransaction</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
  <span style="box-sizing: border-box; font-weight: bold;">if</span> <span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span> <span style="box-sizing: border-box; font-weight: bold;">throw</span> <span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">;</span> <span style="box-sizing: border-box;">}</span>
  <span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'INSERT INTO posts SET title=?'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">title</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">result</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
    <span style="box-sizing: border-box; font-weight: bold;">if</span> <span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span> 
      <span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">rollback</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">()</span> <span style="box-sizing: border-box;">{</span>
        <span style="box-sizing: border-box; font-weight: bold;">throw</span> <span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">;</span>
      <span style="box-sizing: border-box;">});</span>
    <span style="box-sizing: border-box;">}</span>

    <span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">log</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'Post '</span> <span style="box-sizing: border-box; font-weight: bold;">+</span> <span style="box-sizing: border-box;">result</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">insertId</span> <span style="box-sizing: border-box; font-weight: bold;">+</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">' added'</span><span style="box-sizing: border-box;">;</span>

    <span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'INSERT INTO log SET data=?'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">log</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">result</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
      <span style="box-sizing: border-box; font-weight: bold;">if</span> <span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span> 
        <span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">rollback</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">()</span> <span style="box-sizing: border-box;">{</span>
          <span style="box-sizing: border-box; font-weight: bold;">throw</span> <span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">;</span>
        <span style="box-sizing: border-box;">});</span>
      <span style="box-sizing: border-box;">}</span>  
      <span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">commit</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
        <span style="box-sizing: border-box; font-weight: bold;">if</span> <span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span> 
          <span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">rollback</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">()</span> <span style="box-sizing: border-box;">{</span>
            <span style="box-sizing: border-box; font-weight: bold;">throw</span> <span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">;</span>
          <span style="box-sizing: border-box;">});</span>
        <span style="box-sizing: border-box;">}</span>
        <span style="box-sizing: border-box;">console</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">log</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'success!'</span><span style="box-sizing: border-box;">);</span>
      <span style="box-sizing: border-box;">});</span>
    <span style="box-sizing: border-box;">});</span>
  <span style="box-sizing: border-box;">});
</span><span style="box-sizing: border-box;">});</span></pre><pre xml:space="preserve">
请注意，执行START TRANSACTION, COMMIT,和 ROLLBACK 这些简单命令的方法分别是transaction(),Commit()和rollback(),了解MySQL中一些会造成隐式提交语句很重要。具体的可以看看MySQL的官方文档<a href="http://dev.mysql.com/doc/refman/5.5/en/implicit-commit.html" shape="rect" style="box-sizing: border-box; color: rgb(65, 131, 196); outline: 0px; font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px; background-color: rgb(255, 255, 255);">in the MySQL documentation</a></pre><pre style="font-size: 19px;" xml:space="preserve"><b id="error-handling">错误处理</b></pre><pre xml:space="preserve">
这个模块包含了错误处理机制，不过在编码的时候你还应该去自己检查自己的代码。看看是否会有一些意想不到的错误。
</pre><pre xml:space="preserve">
这个模块中所有的错误都是javascript error的对象实例，同时它还有两个属性:
</pre><ul style="box-sizing: border-box; padding: 0px 0px 0px 30px; margin: 15px 0px; color: rgb(51, 51, 51); line-height: 25.5px;"><li style="font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; box-sizing: border-box;"><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; padding: 0px;">err.code</code>: 任一的MySQL错误 <a href="http://dev.mysql.com/doc/refman/5.5/en/error-messages-server.html" shape="rect" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none;">MySQL server error</a> (例如. <code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; padding: 0px;">'ER_ACCESS_DENIED_ERROR'</code>), Node.js错误 (<span style="line-height: 25.5px;">例如</span><span style="line-height: 25.5px;">.</span><code style="line-height: 25.5px; box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; padding: 0px;">'ECONNREFUSED'</code><span style="line-height: 25.5px;">) 或者是内部错误 (e.g. </span><code style="line-height: 25.5px; box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; padding: 0px;">'PROTOCOL_CONNECTION_LOST'</code><span style="line-height: 25.5px;">).</span></li><li style="font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; box-sizing: border-box;"><code style="line-height: 25.5px; box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; padding: 0px;">err.fatal</code><span style="line-height: 25.5px;">:布尔值,这个对象表示是否能够连接到服务器.</span></li></ul><div><span style="color: #333333; font-family: Helvetica, arial, freesans, clean, sans-serif;"><span style="font-size: 15px; line-height: 25px;">致命的错误都可以在回调函数中捕获到。在下面这个例子中,所引起的错误是因为改连接试图连接到一个无效的端口上面。因此错误对象会被传递到回调函数中并且能够使用err.code或err.fatal知道错误的具体情况:<br clear="none"/></span></span><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);" xml:space="preserve"><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">connection</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">require</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'mysql'</span><span style="box-sizing: border-box;">).</span><span style="box-sizing: border-box;">createConnection</span><span style="box-sizing: border-box;">({</span>
  <span style="box-sizing: border-box;">port</span><span style="box-sizing: border-box; font-weight: bold;">:</span> <span style="box-sizing: border-box; color: rgb(0, 153, 153);">84943</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// WRONG PORT</span><span style="box-sizing: border-box;">});</span>

<span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">connect</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
  <span style="box-sizing: border-box;">console</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">log</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">code</span><span style="box-sizing: border-box;">);</span> <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// 'ECONNREFUSED'</span>
  <span style="box-sizing: border-box;">console</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">log</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">fatal</span><span style="box-sizing: border-box;">);</span> <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// true</span><span style="box-sizing: border-box;">});</span>

<span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'SELECT 1'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
  <span style="box-sizing: border-box;">console</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">log</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">code</span><span style="box-sizing: border-box;">);</span> <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// 'ECONNREFUSED'</span>
  <span style="box-sizing: border-box;">console</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">log</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">fatal</span><span style="box-sizing: border-box;">);</span> <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// true</span><span style="box-sizing: border-box;">});</span></pre></div><pre style="text-align: left;" xml:space="preserve">
一般情况下错误是只委托给它所属的回调函数，例如下面这个例子。只有第一个回调函数接收到了错误信息，而第二个同样是按照预期的方式执行的并不会捕获第一个查询的错误：


</pre><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51); text-align: start;" xml:space="preserve"><span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'USE name_of_db_that_does_not_exist'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">rows</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
  <span style="box-sizing: border-box;">console</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">log</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">code</span><span style="box-sizing: border-box;">);</span> <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// 'ER_BAD_DB_ERROR'</span><span style="box-sizing: border-box;">});</span>

<span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'SELECT 1'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">rows</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
  <span style="box-sizing: border-box;">console</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">log</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">);</span> <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// null</span>
  <span style="box-sizing: border-box;">console</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">log</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">rows</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">length</span><span style="box-sizing: border-box;">);</span> <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// 1</span><span style="box-sizing: border-box;">});</span></pre></div><div style="margin-left: 30px;">最后值得提醒的是,有时候你可以把错误处理不放在与查询一起的回调函数里面，就如同上面的那个例子。你可以把错误处理放在连接对象上的错误事件里面。就像下面这样：</div><div style="margin-left: 30px;"><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);" xml:space="preserve"><span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">on</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'error'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
  <span style="box-sizing: border-box;">console</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">log</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">code</span><span style="box-sizing: border-box;">);</span> <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// 'ER_BAD_DB_ERROR'</span><span style="box-sizing: border-box;">});</span>

<span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'USE name_of_db_that_does_not_exist'</span><span style="box-sizing: border-box;">);</span></pre></div><div style="margin-left: 30px;">注意:error在Node中是一个特殊的对象，如果它没有被挂在一个事件上而是单独出现，那么就很有可能出现堆栈错误并且关闭NodeJS程序进程.</div><div style="margin-left: 30px;">最后：这个模块处理错误的初衷都不是悄悄的处理掉错误，你应该把错误的处理放在回调函数里面。但是如果你不喜欢这么麻烦并且忽略掉错误。那么你可以这样做：<br clear="none"/><div><pre style="font-size: 13px; box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal;" xml:space="preserve"><span style="box-sizing: border-box;"><span style="color: #999988;"><em>// I am Chuck Norris:
</em></span></span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">connection</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">.</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">on</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'error'</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">,</span><span style="color: rgb(51, 51, 51); box-sizing: border-box; font-weight: bold;">function</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">()</span><span style="color: rgb(51, 51, 51); box-sizing: border-box;">{
 //...
});</span></pre></div></div><div style="margin-left: 30px; font-size: 19px;"><b>异常安全处理</b></div><div style="margin-left: 30px;">这个模块的异常处理很安全，也就是说在回调函数中抛出一个错误之后你可以使用’uncaughtException‘或域(domain)去捕获错误，然后继续的去使用做下面的事情。</div><div style="margin-left: 30px; font-size: 19px;"><b>类型转换</b></div><div style="margin-left: 30px;">为了您的使用方面，这个驱动会自动把MySQL中的一些类型转换为原生的javascript的类型。下面列举的是转换的类型：</div><div style="margin-left: 30px;"><h3 style="box-sizing: border-box; margin: 1em 0px 15px; line-height: 1.7; padding: 0px; cursor: text; position: relative; color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif;"><span style="font-size: medium;">Number</span></h3><ul style="box-sizing: border-box; padding: 0px 0px 0px 30px; margin: 15px 0px; color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; line-height: 25.5px;"><li style="box-sizing: border-box;">TINYINT</li><li style="box-sizing: border-box;">SMALLINT</li><li style="box-sizing: border-box;">INT</li><li style="box-sizing: border-box;">MEDIUMINT</li><li style="box-sizing: border-box;">YEAR</li><li style="box-sizing: border-box;">FLOAT</li><li style="box-sizing: border-box;">DOUBLE</li></ul><h3 style="box-sizing: border-box; margin: 1em 0px 15px; line-height: 1.7; padding: 0px; cursor: text; position: relative; color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif;"><a href="https://github.com/felixge/node-mysql#date" name="user-content-date" shape="rect" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; cursor: pointer; position: absolute; top: 0px; left: 0px; bottom: 0px;"></a><span style="font-size: medium;">Date</span></h3><ul style="box-sizing: border-box; padding: 0px 0px 0px 30px; margin: 15px 0px; color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; line-height: 25.5px;"><li style="box-sizing: border-box;">TIMESTAMP</li><li style="box-sizing: border-box;">DATE</li><li style="box-sizing: border-box;">DATETIME</li></ul><h3 style="box-sizing: border-box; margin: 1em 0px 15px; line-height: 1.7; padding: 0px; cursor: text; position: relative; color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif;"><a href="https://github.com/felixge/node-mysql#buffer" name="user-content-buffer" shape="rect" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; cursor: pointer; position: absolute; top: 0px; left: 0px; bottom: 0px;"></a><span style="font-size: medium;">Buffer</span></h3><ul style="box-sizing: border-box; padding: 0px 0px 0px 30px; margin: 15px 0px; color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; line-height: 25.5px;"><li style="box-sizing: border-box;">TINYBLOB</li><li style="box-sizing: border-box;">MEDIUMBLOB</li><li style="box-sizing: border-box;">LONGBLOB</li><li style="box-sizing: border-box;">BLOB</li><li style="box-sizing: border-box;">BINARY</li><li style="box-sizing: border-box;">VARBINARY</li><li style="box-sizing: border-box;">BIT (最后一个字节会使用0来填充)</li></ul><h3 style="box-sizing: border-box; margin: 1em 0px 15px; padding: 0px; cursor: text; position: relative; color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; line-height: 1.7;"><a href="https://github.com/felixge/node-mysql#string" name="user-content-string" shape="rect" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; display: block; padding-right: 6px; padding-left: 8px; margin-left: -30px; cursor: pointer; position: absolute; top: 67.265625px; left: 0px; bottom: 0px; line-height: 1;"></a><span style="font-size: medium;">String</span></h3><ul style="box-sizing: border-box; padding: 0px 0px 0px 30px; margin: 15px 0px; color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; line-height: 25.5px;"><li style="box-sizing: border-box;">CHAR</li><li style="box-sizing: border-box;">VARCHAR</li><li style="box-sizing: border-box;">TINYTEXT</li><li style="box-sizing: border-box;">MEDIUMTEXT</li><li style="box-sizing: border-box;">LONGTEXT</li><li style="box-sizing: border-box;">TEXT</li><li style="box-sizing: border-box;">ENUM</li><li style="box-sizing: border-box;">SET</li><li style="box-sizing: border-box;">DECIMAL (可能会超过float精度)</li><li style="box-sizing: border-box;">BIGINT (可能会超过float精度)</li><li style="box-sizing: border-box;">TIME (转换为日期, but what date would be set?)</li><li style="box-sizing: border-box;">GEOMETRY (从来没有用错，当你使用的时候你可以联系我们)<br clear="none"/></li></ul><div><span style="color: #333333; font-family: Helvetica, arial, freesans, clean, sans-serif;"><span style="line-height: 25px;">我们不建议你把类型转换这个参数禁用，但是如果你想禁用也可以在连接的时候就去做（这种方法可能在以后的版本中删除/改变）：</span></span></div><div><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);" xml:space="preserve">
var connection = require(<span style="color: rgb(221, 17, 68);">'mysql'</span>).createConnection({typeCast:<strong>false</strong>});
</pre></div></div><div style="margin-left: 30px;">或者在查询层做：</div><div style="margin-left: 30px;"><div><pre style="font-size: 13px; box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);" xml:space="preserve"><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">options</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">{</span><span style="box-sizing: border-box;">sql</span><span style="box-sizing: border-box; font-weight: bold;">:</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'...'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">typeCast</span><span style="box-sizing: border-box; font-weight: bold;">:</span> <span style="box-sizing: border-box; font-weight: bold;">false</span><span style="box-sizing: border-box;">};
</span><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">query</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">options</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; font-weight: bold;">function</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">err</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">results</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>

<span style="box-sizing: border-box;">});</span></pre></div></div><div style="margin-left: 30px;">你也可以通过一个处理函数来转换自己想要的类型，通过已知的一些字段的信息，像数据库，表名和字段名，数据类型和长度。如果你只想自己定义一个类型转换函数。你可以在查询的回调函数中做。例如你把<span style="background-color: rgb(248, 248, 248); color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px;">TINYINT(1)转换为布尔值：</span></div><div style="margin-left: 30px;"><div><pre style="font-size: 13px; box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);" xml:space="preserve"><span style="box-sizing: border-box;">connection</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">query</span><span style="box-sizing: border-box;">({</span>
  <span style="box-sizing: border-box;">sql</span><span style="box-sizing: border-box; font-weight: bold;">:</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'...'</span><span style="box-sizing: border-box;">,</span>
  <span style="box-sizing: border-box;">typeCast</span><span style="box-sizing: border-box; font-weight: bold;">:</span> <span style="box-sizing: border-box; font-weight: bold;">function</span> <span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">field</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box;">next</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
    <span style="box-sizing: border-box; font-weight: bold;">if</span> <span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">field</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">type</span> <span style="box-sizing: border-box; font-weight: bold;">==</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'TINY'</span> <span style="box-sizing: border-box; font-weight: bold;">&amp;&amp;</span> <span style="box-sizing: border-box;">field</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">length</span> <span style="box-sizing: border-box; font-weight: bold;">==</span> <span style="box-sizing: border-box; color: rgb(0, 153, 153);">1</span><span style="box-sizing: border-box;">)</span> <span style="box-sizing: border-box;">{</span>
      <span style="box-sizing: border-box; font-weight: bold;">return</span> <span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box;">field</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">string</span><span style="box-sizing: border-box;">()</span> <span style="box-sizing: border-box; font-weight: bold;">==</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'1'</span><span style="box-sizing: border-box;">);</span> <span style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// 1 = true, 0 = false</span>
    <span style="box-sizing: border-box;">}</span>
    <span style="box-sizing: border-box; font-weight: bold;">return</span> <span style="box-sizing: border-box;">next</span><span style="box-sizing: border-box;">();</span>
  <span style="box-sizing: border-box;">}</span><span style="box-sizing: border-box;">});</span></pre></div></div><div style="margin-left: 30px;"><span style="color: #333333; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: small;"><span style="line-height: 20px;">警告：</span></span>你必须使用解析器中内建的三个field函数中的一个，在你自定义的类型转换回调函数中。他们只能调用一次：</div><div style="margin-left: 30px;"><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);" xml:space="preserve"><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: none; background-color: transparent; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; padding: 0px; word-wrap: normal; display: inline; line-height: inherit;">field.string()
field.buffer()
field.geometry()</code></pre></div><div style="margin-left: 30px;">或者使用别名：</div><div style="margin-left: 30px;"><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);" xml:space="preserve"><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: none; background-color: transparent; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; padding: 0px; word-wrap: normal; display: inline; line-height: inherit;">parser.parseLengthCodedString()
parser.parseLengthCodedBuffer()
parser.parseGeometryValue()</code></pre></div><div style="margin-left: 30px;">如果你需要使用field函数，。你可以在<span style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px; background-color: rgb(255, 255, 255);"><a href="https://github.com/felixge/node-mysql/blob/master/lib/protocol/packets/RowDataPacket.js#L41" shape="rect" style="font-weight: bold; box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none;">RowDataPacket.prototype._typeCast</a>中找到关于field函数的一些文档资料</span></div><div style="margin-left: 30px;"><span style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px; background-color: rgb(255, 255, 255);"><br clear="none"/></span></div><div style="margin-left: 30px; font-size: 19px;"><span style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; line-height: 25.5px; background-color: rgb(255, 255, 255);"><b>连接标记</b></span></div><div style="margin-left: 30px;"><span style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; line-height: 25.5px; background-color: rgb(255, 255, 255);">如果,由于某些原因你需要修改默认的连接标记,那么你可能需要使用</span><span style="background-color: rgb(248, 248, 248); color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px;">flags</span><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px;">选项。通过在连接配置的选项列表中添加这个选项，那么你就可以修改默认的连接标记.如果你不想使用默认的flag你可以使用一个减号来取消掉。或者在连接的配置选项列表里面添加一个flag选项，而不写值，仅仅就是一个flag名字在哪里（不区分大小写）。PS:不想像去掉flag选项一样在flag的前面加一个+号：</span></div><div style="margin-left: 30px;"><strong><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px;">请注意：有些默认的flag目前还不支持（例如：SSL,</span>Compression<span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px;">）。</span></strong></div><div style="margin-left: 30px;"><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px;">例子：</span></div><div style="margin-left: 30px;"><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px;">下面的例子是使用黑名单</span><span style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px;">FOUND_ROWS</span><span style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px;"> </span><span style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); line-height: 20px;"><span style="font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: small;">flag例子：</span></span></div><div style="margin-left: 30px;"><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);" xml:space="preserve"><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">connection</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">mysql</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">createConnection</span><span style="box-sizing: border-box;">(</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">&quot;mysql://localhost/test?flags=-FOUND_ROWS&quot;</span><span style="box-sizing: border-box;">);</span></pre></div><div style="margin-left: 30px; font-size: 19px;"><span style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); line-height: 20px;"><span style="font-family: Consolas, 'Liberation Mono', Courier, monospace;"><b>默认标记</b></span></span></div><div style="margin-left: 30px;"><ul style="box-sizing: border-box; padding: 0px 0px 0px 30px; margin: 15px 0px; color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px;"><li style="box-sizing: border-box;">LONG_PASSWORD</li><li style="box-sizing: border-box;">FOUND_ROWS</li><li style="box-sizing: border-box;">LONG_FLAG</li><li style="box-sizing: border-box;">CONNECT_WITH_DB</li><li style="box-sizing: border-box;">ODBC</li><li style="box-sizing: border-box;">LOCAL_FILES</li><li style="box-sizing: border-box;">IGNORE_SPACE</li><li style="box-sizing: border-box;">PROTOCOL_41</li><li style="box-sizing: border-box;">IGNORE_SIGPIPE</li><li style="box-sizing: border-box;">TRANSACTIONS</li><li style="box-sizing: border-box;">RESERVED</li><li style="box-sizing: border-box;">SECURE_CONNECTION</li><li style="box-sizing: border-box;">MULTI_RESULTS</li><li style="box-sizing: border-box;">MULTI_STATEMENTS (如果使用 <code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; padding: 0px;">multipleStatements</code>  选项就激活)</li></ul><div style="font-size: 19px;"><span style="color: #333333; font-family: Helvetica, arial, freesans, clean, sans-serif;"><span style="line-height: 25px;"><b>其他的可用标记</b></span></span></div><div><ul style="box-sizing: border-box; padding: 0px 0px 0px 30px; margin: 15px 0px; color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px;"><li style="box-sizing: border-box;">NO_SCHEMA</li><li style="box-sizing: border-box;">COMPRESS</li><li style="box-sizing: border-box;">INTERACTIVE</li><li style="box-sizing: border-box;">SSL</li><li style="box-sizing: border-box;">PS_MULTI_RESULTS</li><li style="box-sizing: border-box;">PLUGIN_AUTH</li><li style="box-sizing: border-box;">SSL_VERIFY_SERVER_CERT</li><li style="box-sizing: border-box;">REMEMBER_OPTIONS</li></ul><div style="font-size: 19px;"><span style="color: #333333; font-family: Helvetica, arial, freesans, clean, sans-serif;"><span style="line-height: 25px;"><b>调试与问题查看</b></span></span></div></div><div><span style="color: #333333; font-family: Helvetica, arial, freesans, clean, sans-serif;"><span style="line-height: 25px;">如果在运行过程中出现了问题，你可以在连接的配置选项中添加一个debug参数来帮助你调试：</span></span></div><div><div style="box-sizing: border-box; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px;"><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal;" xml:space="preserve"><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">connection</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">mysql</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">createConnection</span><span style="box-sizing: border-box;">({</span><span style="box-sizing: border-box;">debug</span><span style="box-sizing: border-box; font-weight: bold;">:</span> <span style="box-sizing: border-box; font-weight: bold;">true</span><span style="box-sizing: border-box;">});</span></pre></div><br clear="none"/><span style="color: #333333; font-family: Helvetica, arial, freesans, clean, sans-serif;"><span style="line-height: 25px;">它会将输入的信息与输出的信息标准输出的显示出来，你还可以通过把数据包的类型转换成一个数据数组对象来方便调试:</span></span></div><div><div style="box-sizing: border-box; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px;"><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal;" xml:space="preserve"><span style="box-sizing: border-box; font-weight: bold;">var</span> <span style="box-sizing: border-box;">connection</span> <span style="box-sizing: border-box; font-weight: bold;">=</span> <span style="box-sizing: border-box;">mysql</span><span style="box-sizing: border-box;">.</span><span style="box-sizing: border-box;">createConnection</span><span style="box-sizing: border-box;">({</span><span style="box-sizing: border-box;">debug</span><span style="box-sizing: border-box; font-weight: bold;">:</span> <span style="box-sizing: border-box;">[</span><span style="box-sizing: border-box; color: rgb(221, 17, 68);">'ComQueryPacket'</span><span style="box-sizing: border-box;">,</span> <span style="box-sizing: border-box; color: rgb(221, 17, 68);">'RowDataPacket'</span><span style="box-sizing: border-box;">]});</span></pre></div><br clear="none"/></div><div><span style="color: #333333; font-family: Helvetica, arial, freesans, clean, sans-serif;"><span style="line-height: 25px;">限制查询与数据包；</span></span></div><div><span style="color: #333333; font-family: Helvetica, arial, freesans, clean, sans-serif;"><span style="line-height: 25px;">如果没有帮助，你可以打开github的问答社区。一个好的</span></span><span style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px;">GitHub</span><span style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; line-height: 25.5px;">问题有以下几个特征：</span></div><div><ul><li><span style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; line-height: 25.5px;">提供能够重现该问题的代码（如果可以）</span></li><li><span style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; line-height: 25.5px;">尽可能的说清楚您的调试环境（MySQL版本，nodeJS版本，操作系统等等）。</span></li></ul></div><div><span style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; line-height: 25.5px;">运行单元测试</span></div><div><span style="color: #333333; font-family: Helvetica, arial, freesans, clean, sans-serif;"><span style="line-height: 25px;">设置环境变量</span></span><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; padding: 0px; color: rgb(51, 51, 51);">MYSQL_DATABASE</code><span style="color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px; background-color: rgb(255, 255, 255);">, </span><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; padding: 0px; color: rgb(51, 51, 51);">MYSQL_HOST</code><span style="color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px; background-color: rgb(255, 255, 255);">, </span><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; padding: 0px; color: rgb(51, 51, 51);">MYSQL_PORT</code><span style="color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px; background-color: rgb(255, 255, 255);">, </span><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; padding: 0px; color: rgb(51, 51, 51);">MYSQL_USER</code><span style="color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px; background-color: rgb(255, 255, 255);"> 和 </span><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; padding: 0px; color: rgb(51, 51, 51);">MYSQL_PASSWORD</code>。当你测试的时候你可以需要把这些配置放在一个config.sh文件或者是源代码中。然后运行<span style="background-color: rgb(248, 248, 248); color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px;">make test</span>。</div><div>例如，你安装的MySQL是运行在localhost:3306上面并且没有给root设置密码，那么你可以像下面这样做：</div><div><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51);" xml:space="preserve"><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: none; background-color: transparent; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; padding: 0px; word-wrap: normal; display: inline; line-height: inherit;">mysql -u root -e &quot;CREATE DATABASE IF NOT EXISTS node_mysql_test&quot;
  MYSQL_HOST=localhost MYSQL_PORT=3306 MYSQL_DATABASE=node_mysql_test MYSQL_USER=root MYSQL_PASSWORD= make test</code></pre></div><div>在Windows上面运行单元测试</div><div><ul><li>根据你的系统与MySQL设置把环境变量编辑在一个<span style="background-color: rgb(248, 248, 248); color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left;">make.bat</span>文件中。</li><li>确保你的数据库（例如：test）能够使用你提供的用户能够正常的登录进去。（例如：在新建用户之后忘记执行SQL命令 <span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">FLUSH PRIVILEGES</span>）。</li><li>在Dos窗口（CMD Shell）并且是你的应用目录下面执行 <span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">npm install mysql --dev</span>或者在MySQL目录（ <span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">node_modules\mysql</span>）下面执行 <code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; padding: 0px; color: rgb(51, 51, 51); text-align: left;">npm install --dev</code><span style="color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px; text-align: left; background-color: rgb(255, 255, 255);">. </span>（这样就会安装开发版的node-mysql模块）。</li><li>在你的应用程序的目录运行 <span style="color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px; text-align: left; background-color: rgb(255, 255, 255);"> </span><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; padding: 0px; color: rgb(51, 51, 51); text-align: left;">npm test mysql</code>或者在MySQL文件下面执行 <span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 20.399999618530273px; text-align: left; background-color: rgb(248, 248, 248);">npm test</span></li><li>如果你想要把日志保存在一个文件里面可以使用 <code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; padding: 0px; color: rgb(51, 51, 51); text-align: left;">npm test mysql &gt; test.log</code><span style="color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px; text-align: left; background-color: rgb(255, 255, 255);"> 或 </span><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; padding: 0px; color: rgb(51, 51, 51); text-align: left;">npm test &gt; test.log</code><span style="color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px; text-align: left; background-color: rgb(255, 255, 255);">.</span></li></ul><div style="text-align: left;"><span style="color: #333333; font-family: Helvetica, arial, freesans, clean, sans-serif;"><span style="font-size: 15px; line-height: 25px;"><b>备忘录</b></span></span></div></div><div style="text-align: left;"><ul><li><span style="line-height: 25px; color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif;">预查询语句</span></li><li><span style="line-height: 25px; color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif;">查询时调用</span> <span style="color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px; background-color: rgb(255, 255, 255);">setTimeout() </span><span style="color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; line-height: 25.5px; background-color: rgb(255, 255, 255);">方法</span></li><li><span style="color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; line-height: 25.5px; background-color: rgb(255, 255, 255);">支持 <span style="line-height: 25.5px;">UTF-8 / ASCII</span>编码</span></li></ul></div></div><div style="margin-left: 30px;"><span style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px; background-color: rgb(255, 255, 255);"><br clear="none"/></span></div></div>
</div></body></html> 